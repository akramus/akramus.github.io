{"version":3,"sources":["webpack:///path---blog-deploy-a-website-api-with-serverless-fa74e0307b5344956be6.js","webpack:///./.cache/json/blog-deploy-a-website-api-with-serverless.json"],"names":["webpackJsonp","372","module","exports","data","markdownRemark","html","frontmatter","title","date","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,gBAAkBC,KAAA;AAAg8iCC,aAA42CC,MAAA,2CAAAC,KAAA,gBAAyEC,aAAgBC,KAAA","file":"path---blog-deploy-a-website-api-with-serverless-fa74e0307b5344956be6.js","sourcesContent":["webpackJsonp([224177312327221],{\n\n/***/ 372:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<p>You’ve written an awesome REST API or GraphQL endpoint and a stellar web UI and you want to deploy it. Then you shudder. There are so many options and you don’t know which to choose. If you are looking for a non managed solution maybe you deploy to Next.js, Heroku or AWS Elastic Beanstalk. If you got the chops, you could deploy to AWS EC2 or Digital Ocean.</p>\\n<p>Up until recently I would have said that if it’s a small hobby project or prototype, just deploy it to one of the aforementioned platform as a service (PaaS) options. If it was a project where you were going to need to scale and had in-house DevOps talent, then I would have previously said, take the infrastructure as a service (IaaS) route. Now in 2017 my thoughts on the matter have completely changed.</p>\\n<p>Enter <a href=\\\"https://serverless.com/framework/docs/\\\">The Serverless Framework</a>... An open source project that helps with the deployment of serverless cloud infrastructure. Serverless as in the idea, not the framework, is a new-\\\"ish\\\" way to develop applications. The main idea is that you can abstract far above the idea of a server which is managed for you, and you pay for the functions you run or the web pages you load. With the Serverless Framework, you can deploy cloud assets to either AWS, IBM OpenWisk, Google Cloud, or Azure. Before we go further, and to avoid confusion when reading this blog post if I say Serverless from now on, I mean the Serverless Framework.</p>\\n<p>Let me give quick example of how you would deploy a project with Serverless. Let’s use the example of a static website. If your preferred Serverless Framework provider was AWS, and you wanted to deploy an API, you would create a configuration file that included the instructions to deploy the website the API. Then you include the api code as an exported function, then deploy and voila, you have an API in the cloud. It’s that easy.</p>\\n<h4>By the end of this blog post you will know how to:</h4>\\n<ol>\\n<li>Setup project files and code</li>\\n<li>Setup the Serverless configuration file</li>\\n<li>Test the code in the local environment</li>\\n<li>Deploy to the cloud</li>\\n</ol>\\n<h4>Pre-requistes before getting started</h4>\\n<ul>\\n<li>You must have Node.js installed. To do this you need to go to <a href=\\\"nodejs.org\\\">Nodejs.org</a> and download it. Be sure to download LTS</li>\\n<li>Know how to read JavaScript (although you can write functions in Python, C# and JVM compatible languages)</li>\\n<li>An mild familiarity with AWS will be helpful to understanding what's going on.</li>\\n<li>Have serverless installed. Once you have npm installed just type <code class=\\\"language-text\\\">npm install -g serverless</code> in any directory in your terminal</li>\\n<li>\\n<p>I will use AWS for this tutorial since it is my preferred cloud provider, so that means you’ll need to install and authenticate the aws-cli. This can be done by reading through following three articles.</p>\\n<ol>\\n<li><a href=\\\"http://docs.aws.amazon.com/cli/latest/userguide/installing.html\\\">aws-cli installed</a></li>\\n<li><a href=\\\"http://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console\\\">AWS user created with programmatic access</a></li>\\n<li><a href=\\\"http://docs.aws.amazon.com/cli/latest/userguide/cli-config-files.html\\\">aws-cli authenticated</a></li>\\n</ol>\\n</li>\\n</ul>\\n<h3>Setting up the Project Files and Code</h3>\\n<p><a href=\\\"https://github.com/danielbh/getting-started-with-serverless-tutorial\\\">You can obtain the completed project here</a>. You will still need to add your Lambda endpoint to <code class=\\\"language-text\\\">index.html</code> to make it work.</p>\\n<p>Create the project in a desired location and then add the following files:</p>\\n<p>Add a file called <code class=\\\"language-text\\\">handler.js</code>. This will be the file that contains your lambda function. This lambda function will return your IP address.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">module<span class=\\\"token punctuation\\\">.</span>exports<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">getIP</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">,</span> context<span class=\\\"token punctuation\\\">,</span> callback<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> response <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    statusCode<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// 1</span>\\n    headers<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token string\\\">'Access-Control-Allow-Origin'</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'*'</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token comment\\\">// 2</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    body<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">.</span>requestContext<span class=\\\"token punctuation\\\">.</span>identity<span class=\\\"token punctuation\\\">.</span>sourceIp<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">//3</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">callback</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span> response<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<ol>\\n<li>A <code class=\\\"language-text\\\">200</code> status code is returned which signals that the function was run successfully.</li>\\n<li>This is required to allow Cross Origin Resource Sharing (CORS). Under default conditions a web page is not allowed to make http requests from an API that does not share the same domain name. CORS exists to prevent a security vulnerability called Cross-Site Request Forgery (CSRF). You can <a href=\\\"https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)\\\">read more about this vulnerability at OWASP</a>. For the purposes of this demo, it's not a big deal.</li>\\n<li>This will respond to the request with your IP address.</li>\\n</ol>\\n<p>Now, create a directory called <code class=\\\"language-text\\\">dist</code> and add a filed called <code class=\\\"language-text\\\">index.html</code>. This will be the static asset that you deploy as the front-end website for your lambda function. It will display your external IP address.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token doctype\\\">&lt;!DOCTYPE html></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>html</span> <span class=\\\"token attr-name\\\">lang</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>en<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">charset</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>UTF-8<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>title</span><span class=\\\"token punctuation\\\">></span></span>Hello Serverless<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>title</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script language-javascript\\\">\\n            <span class=\\\"token comment\\\">// 1</span>\\n            <span class=\\\"token keyword\\\">const</span> xhttp <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">XMLHttpRequest</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n            xhttp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">onreadystatechange</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>readyState <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">4</span> <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>status <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n                document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"app\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>responseText <span class=\\\"token comment\\\">// 2</span>\\n              <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n            <span class=\\\"token comment\\\">// 3</span>\\n            xhttp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">open</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"GET\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"http://localhost:3000\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n            xhttp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">send</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        </span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h1</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>app<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>html</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<ol>\\n<li>This is how old people make http requests with javascript in the browser.</li>\\n<li>The callback for receiving the external IP address. If the external IP address is successfully received it will print it to the webpage.</li>\\n<li>This is the code that executes the request to your lambda function.</li>\\n</ol>\\n<p>Now add <code class=\\\"language-text\\\">404.html</code>. This will be used when a user requests a page that does not exist.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token doctype\\\">&lt;!DOCTYPE html></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>html</span> <span class=\\\"token attr-name\\\">lang</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>en<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">charset</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>UTF-8<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>title</span><span class=\\\"token punctuation\\\">></span></span>404 Error<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>title</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h1</span><span class=\\\"token punctuation\\\">></span></span>404 Error: This page does not exist<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>html</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<h3>Setup the Serverless Configuration File</h3>\\n<p>Add <code class=\\\"language-text\\\">serverless.yml</code> to the root directory. This is the configuration file that will configure your cloud infrastructure. If you have never used yaml then you should keep in mind that white spaces do matter. It's basically JSON without brackets, commas, or apostrophes.</p>\\n<p>A <code class=\\\"language-text\\\">serverless.yml</code> template is divided into blocks. Each block as a purpose (see below).</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-yaml\\\"><code class=\\\"language-yaml\\\"><span class=\\\"token comment\\\"># 1</span>\\n<span class=\\\"token key atrule\\\">service</span><span class=\\\"token punctuation\\\">:</span> hello<span class=\\\"token punctuation\\\">-</span>serverless\\n\\n<span class=\\\"token comment\\\"># 2</span>\\n<span class=\\\"token key atrule\\\">provider</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> aws\\n  <span class=\\\"token key atrule\\\">runtime</span><span class=\\\"token punctuation\\\">:</span> nodejs6.10\\n  <span class=\\\"token key atrule\\\">region</span><span class=\\\"token punctuation\\\">:</span> us<span class=\\\"token punctuation\\\">-</span>east<span class=\\\"token punctuation\\\">-</span><span class=\\\"token number\\\">1</span>\\n\\n<span class=\\\"token comment\\\"># 3</span>\\n<span class=\\\"token key atrule\\\">functions</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token comment\\\">#4</span>\\n  <span class=\\\"token key atrule\\\">getIP</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">handler</span><span class=\\\"token punctuation\\\">:</span> handler.getIP\\n    <span class=\\\"token comment\\\"># 5</span>\\n    <span class=\\\"token key atrule\\\">events</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">http</span><span class=\\\"token punctuation\\\">:</span>\\n          <span class=\\\"token key atrule\\\">path</span><span class=\\\"token punctuation\\\">:</span> /\\n          <span class=\\\"token key atrule\\\">method</span><span class=\\\"token punctuation\\\">:</span> get\\n          <span class=\\\"token key atrule\\\">cors</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">true</span>\\n<span class=\\\"token comment\\\"># 6</span>\\n<span class=\\\"token key atrule\\\">resources</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">Outputs</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token comment\\\"># 7</span>\\n    <span class=\\\"token key atrule\\\">WebSiteUrl</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">Value</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token key atrule\\\">\\\"Fn::GetAtt\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>WebSite<span class=\\\"token punctuation\\\">,</span> WebsiteURL<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token key atrule\\\">WebSiteBucket</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">Value</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token key atrule\\\">Ref</span><span class=\\\"token punctuation\\\">:</span> WebSite<span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token key atrule\\\">Resources</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">WebSite</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">Type</span><span class=\\\"token punctuation\\\">:</span> \\\"AWS<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span>S3<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span>Bucket\\\" <span class=\\\"token comment\\\"># 8</span>\\n      <span class=\\\"token key atrule\\\">Properties</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token key atrule\\\">WebsiteConfiguration</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token comment\\\"># 9</span>\\n          <span class=\\\"token key atrule\\\">IndexDocument</span><span class=\\\"token punctuation\\\">:</span> index.html <span class=\\\"token comment\\\"># 10</span>\\n          <span class=\\\"token key atrule\\\">ErrorDocument</span><span class=\\\"token punctuation\\\">:</span> 404.html <span class=\\\"token comment\\\"># 11</span></code></pre>\\n      </div>\\n<ol>\\n<li>The <code class=\\\"language-text\\\">service</code> block is the name of the service</li>\\n<li>The <code class=\\\"language-text\\\">provider</code> block defines where your service will be deployed</li>\\n<li>The <code class=\\\"language-text\\\">functions</code> block defines what code to deploy. This is where you describe the lambda function you are deploying. This function is called \\\"getIP\\\". It has a handler that uses <code class=\\\"language-text\\\">handler.getIP</code> which maps back to the handler.js file.</li>\\n<li>The <code class=\\\"language-text\\\">events</code> block defines how to trigger the handler code. It states the path, to call the function, the REST method to use, and whether or not CORS is allowed.</li>\\n<li>The <code class=\\\"language-text\\\">resources</code> block defines additional resources to be provisioned. This can include a CloudFront distribution, SSL certifications, DNS mappings etc...</li>\\n<li>When you deploy this project it will create a <a href=\\\"https://aws.amazon.com/cloudformation/\\\">Cloud Formation</a> stack in AWS. The outputs are variables that are created when the Cloud Formation stack has finished initializing. You can access these outputs via an API. In this case we are saving these output urls for later, to deploy the static files with a shell script.</li>\\n<li>This will create an S3 bucket in AWS.</li>\\n<li>This will set the s3 bucket to be a static website mode.</li>\\n<li>This tells AWS where to find the index web page for the site.</li>\\n<li>This tells AWS where to put the \\\"not found\\\" web page for the site.</li>\\n</ol>\\n<h3>Test the code in the local environment</h3>\\n<p>Before deploying, it's nice to see if the code will work in the local environment. The API can be tested by downloading a Serverless plugin and running it. Serverless plugins are used to help the development process of Serverless API's. <a href=\\\"https://github.com/serverless/plugins\\\">Here is a comprehensive list of Serverless plugins</a>.</p>\\n<p>For this project we will use <code class=\\\"language-text\\\">serverless-offline</code> to enable offline support. To download it you need to type <code class=\\\"language-text\\\">npm i serverless-offline --save-dev</code>. This will add the dependency, and note it in the <code class=\\\"language-text\\\">package.json</code> in your root directory. This will help future developers install this project in their local environment.</p>\\n<p>Now you must add the plugin to <code class=\\\"language-text\\\">serverless.yml</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"> ...\\n\\n plugins:\\n    - serverless-offline</code></pre>\\n      </div>\\n<p>Now in the root directory type <code class=\\\"language-text\\\">serverless offline</code> you can also type <code class=\\\"language-text\\\">sls offline</code>.\\nNow open <code class=\\\"language-text\\\">index.html</code>. You should see \\\"127.0.0.1\\\" in the browser. This is your local IP. You will change the API endpoint address in <code class=\\\"language-text\\\">index.html</code> later, to point it to the live function.</p>\\n<h3>Deploy the Project</h3>\\n<p>Now it's time to deploy the tutorial!</p>\\n<p> All you need to do is the following in your terminal in the root directory: <code class=\\\"language-text\\\">sls deploy</code>.</p>\\n<p>It will take a few minutes maximum, but when its done it will output the endpoint URL. After its done the terminal output will look close to this...</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">danielhollcraft:~/projectDir $ sls deploy\\nServerless: Packaging service<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Creating Stack<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Checking Stack create progress<span class=\\\"token punctuation\\\">..</span>.\\n<span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span>.\\nServerless: Stack create finished<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Uploading CloudFormation <span class=\\\"token function\\\">file</span> to S3<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Uploading artifacts<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Uploading <span class=\\\"token function\\\">service</span> .zip <span class=\\\"token function\\\">file</span> to S3 <span class=\\\"token punctuation\\\">(</span>4.07 MB<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">..</span>.\\nServerless: Updating Stack<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Checking Stack update progress<span class=\\\"token punctuation\\\">..</span>.\\n<span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span>.\\nServerless: Stack update finished<span class=\\\"token punctuation\\\">..</span>.\\nService Information\\nservice: hello-serverless\\nstage: dev\\nregion: us-east-1\\napi keys:\\n  None\\nendpoints:\\n  GET - https://<span class=\\\"token operator\\\">&lt;</span>endpoint-id<span class=\\\"token operator\\\">></span>.execute-api.us-east-1.amazonaws.com/dev/\\n<span class=\\\"token punctuation\\\">..</span>.</code></pre>\\n      </div>\\n<p>What did it do? It deployed an endpoint on AWS by generating a lambda function and connects the function to the API gateway so you can access it via a REST API. It also created two s3 buckets. One that will hold the web ui code (we'll deploy that next), and one to hold the Cloud Formation template which contains instructions for creating the infrastructure that was just generated. Also included, is a zipped bundle of your endpoint functions that you just deployed.</p>\\n<p>It should be noted that you deployed to <code class=\\\"language-text\\\">dev</code> which means you deployed to a testing endpoint. Of course you could use it for production, but it's encouraged to create another endpoint for production. One for testing, one for production. This is standard development life cycle workflow. To deploy to production you would type <code class=\\\"language-text\\\">sls deploy --stage &lt;whatever-you-call-production&gt;</code></p>\\n<p>Now it's time to deploy the front end code. You'll need to copy and paste the new endpoint URL of your live lambda function into <code class=\\\"language-text\\\">index.html</code>. The endpoint id can be found in the above terminal output. Copy and paste your your own endpoint.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">endpoints:\\n  GET - https://&lt;endpoint-id&gt;.execute-api.us-east-1.amazonaws.com/dev/</code></pre>\\n      </div>\\n<p>Copy it into the below part of the <code class=\\\"language-text\\\">index.html</code> file...</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"> xhttp.open(&quot;GET&quot;, /*copy it here*/, true);</code></pre>\\n      </div>\\n<p>As of July 2017, the shortest and most elegant way to deploy static files to a Serverless project for web rendering, is with bash scripts. I won't explain these too much, but essentially the below scripts will take the Cloud Formation Outputs that we placed in the <code class=\\\"language-text\\\">serverless.yml</code>, and it will use this to access the website bucket. By default these scripts will manipulate the dev bucket. You will need to add the stage name if you wish to target a different bucket. This can be done by appending the stage name at the end of the command <code class=\\\"language-text\\\">. script.sh &lt;name of stage&gt;</code>.</p>\\n<p>I recommend you create a directory called <code class=\\\"language-text\\\">scripts</code> and add the two scripts in.</p>\\n<p><code class=\\\"language-text\\\">deploy-static-files.sh</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token comment\\\">#!/usr/bin/env bash</span>\\n\\n<span class=\\\"token keyword\\\">set</span> -eu\\n\\nSTAGE<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">${1:-dev}</span>\\\"</span>\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Deploying static assets to <span class=\\\"token variable\\\">${STAGE}</span>...\\\"</span>\\n\\nBUCKET_NAME<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span>aws \\\\\\n    cloudformation describe-stacks \\\\\\n    --stack-name <span class=\\\"token string\\\">\\\"hello-serverless-<span class=\\\"token variable\\\">${STAGE}</span>\\\"</span> \\\\\\n    --query <span class=\\\"token string\\\">\\\"Stacks[0].Outputs[?OutputKey=='WebSiteBucket'] | [0].OutputValue\\\"</span> \\\\\\n    --output text<span class=\\\"token variable\\\">)</span></span>\\n\\nWEBSITE_URL<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span>aws \\\\\\n    cloudformation describe-stacks \\\\\\n    --stack-name <span class=\\\"token string\\\">\\\"hello-serverless-<span class=\\\"token variable\\\">${STAGE}</span>\\\"</span> \\\\\\n    --query <span class=\\\"token string\\\">\\\"Stacks[0].Outputs[?OutputKey=='WebSiteUrl'] | [0].OutputValue\\\"</span> \\\\\\n    --output text<span class=\\\"token variable\\\">)</span></span>\\n\\n<span class=\\\"token comment\\\">#Deploy site content</span>\\naws s3 <span class=\\\"token function\\\">sync</span> --acl <span class=\\\"token string\\\">'public-read'</span> --delete dist <span class=\\\"token string\\\">\\\"s3://<span class=\\\"token variable\\\">${BUCKET_NAME}</span>/\\\"</span>\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Bucket URL: <span class=\\\"token variable\\\">${WEBSITE_URL}</span>\\\"</span></code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">delete-static-files.sh</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token comment\\\">#!/usr/bin/env bash</span>\\n\\n<span class=\\\"token keyword\\\">set</span> -eu\\n\\nSTAGE<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">${1:-dev}</span>\\\"</span>\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"You are about to DELETE ALL STATIC ASSETS from <span class=\\\"token variable\\\">${STAGE}</span>\\\"</span>\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"If that's not what you want, press ctrl-C to kill this script\\\"</span>\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Or press enter to continue\\\"</span>\\n\\n<span class=\\\"token function\\\">read</span>\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Deleting static assets from <span class=\\\"token variable\\\">${STAGE}</span>...\\\"</span>\\n\\nBUCKET_NAME<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span>aws \\\\\\n    cloudformation describe-stacks \\\\\\n    --stack-name <span class=\\\"token string\\\">\\\"danielhollcraft-<span class=\\\"token variable\\\">${STAGE}</span>\\\"</span> \\\\\\n    --query <span class=\\\"token string\\\">\\\"Stacks[0].Outputs[?OutputKey=='WebSiteBucket'] | [0].OutputValue\\\"</span> \\\\\\n    --output text<span class=\\\"token variable\\\">)</span></span>\\n\\n<span class=\\\"token function\\\">mkdir</span> /tmp/empty\\n\\naws s3 <span class=\\\"token function\\\">sync</span> --delete /tmp/empty/ <span class=\\\"token string\\\">\\\"s3://<span class=\\\"token variable\\\">${BUCKET_NAME}</span>/\\\"</span>\\n\\n<span class=\\\"token function\\\">rmdir</span> /tmp/empty\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Bucket <span class=\\\"token variable\\\">${BUCKET_NAME}</span> has been emptied\\\"</span></code></pre>\\n      </div>\\n<p>You can add commands in the package.json to make calling these scripts easier</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token punctuation\\\">{</span>\\n\\n<span class=\\\"token operator\\\">...</span>\\n\\n <span class=\\\"token string\\\">\\\"scripts\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token string\\\">\\\"static:deploy\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"./scripts/deploy_static_files.sh\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token string\\\">\\\"static:destroy\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"./scripts/delete_static_files.sh\\\"</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Now to deploy your static files type the following in the root directory of your project: <code class=\\\"language-text\\\">npm run static:deploy</code>.</p>\\n<p>The terminal should output the following:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">Deploying static assets to dev<span class=\\\"token punctuation\\\">..</span>.\\nupload: dist/404.html to s3://hello-serverless-dev-website-uzv5zwnqswdi/404.html\\nupload: dist/index.html to s3://hello-serverless-dev-website-uzv5zwnqswdi/index.html\\nBucket URL: http://hello-serverless-dev-website-<span class=\\\"token operator\\\">&lt;</span>website-id<span class=\\\"token operator\\\">></span>.s3-website-us-east-1.amazonaws.com</code></pre>\\n      </div>\\n<p>Now navigate to the bucket URL. You now have an app that displays your external IP address to a web page!</p>\\n<h3>Next Steps...</h3>\\n<p>Serverless can also be used to setup the DNS routes to your static webste and implement SSL (for free). You can also setup a CloudFront distributions to cache your static assets for better site performance.</p>\\n<p>If you'd like to dive deeper with Serverless I recommend the following resources:</p>\\n<ul>\\n<li>\\n<p><a href=\\\"https://acloud.guru/bundle/start-serverless\\\">A Cloud Guru Serverless Bundle Course</a>: As far as I'm concerned these guys are the best at AWS cloud training out there. I've taken many of their courses, including this bundled course.</p>\\n</li>\\n<li>\\n<p><a href=\\\"https://serverless.com/framework/docs/\\\">Serverless Framework Documentation</a>: It's very detailed and useful.</p>\\n</li>\\n<li>\\n<p><a href=\\\"https://github.com/serverless/examples\\\">Serverless Framework Example Github Respository</a>: Where you can find many different starting templates for your next Serverless project.</p>\\n</li>\\n</ul>\\n<p>That's a wrap. If you have any more questions, or if you just want to nerd out over Serverless with a cup of coffee, feel free to <a href=\\\"/contact/\\\">contact me</a>.</p>\",\"frontmatter\":{\"title\":\"Deploy a Website and API with Serverless\",\"date\":\"07/19/2017\"}}},\"pathContext\":{\"slug\":\"/blog/deploy-a-website-api-with-serverless/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---blog-deploy-a-website-api-with-serverless-fa74e0307b5344956be6.js","module.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<p>You’ve written an awesome REST API or GraphQL endpoint and a stellar web UI and you want to deploy it. Then you shudder. There are so many options and you don’t know which to choose. If you are looking for a non managed solution maybe you deploy to Next.js, Heroku or AWS Elastic Beanstalk. If you got the chops, you could deploy to AWS EC2 or Digital Ocean.</p>\\n<p>Up until recently I would have said that if it’s a small hobby project or prototype, just deploy it to one of the aforementioned platform as a service (PaaS) options. If it was a project where you were going to need to scale and had in-house DevOps talent, then I would have previously said, take the infrastructure as a service (IaaS) route. Now in 2017 my thoughts on the matter have completely changed.</p>\\n<p>Enter <a href=\\\"https://serverless.com/framework/docs/\\\">The Serverless Framework</a>... An open source project that helps with the deployment of serverless cloud infrastructure. Serverless as in the idea, not the framework, is a new-\\\"ish\\\" way to develop applications. The main idea is that you can abstract far above the idea of a server which is managed for you, and you pay for the functions you run or the web pages you load. With the Serverless Framework, you can deploy cloud assets to either AWS, IBM OpenWisk, Google Cloud, or Azure. Before we go further, and to avoid confusion when reading this blog post if I say Serverless from now on, I mean the Serverless Framework.</p>\\n<p>Let me give quick example of how you would deploy a project with Serverless. Let’s use the example of a static website. If your preferred Serverless Framework provider was AWS, and you wanted to deploy an API, you would create a configuration file that included the instructions to deploy the website the API. Then you include the api code as an exported function, then deploy and voila, you have an API in the cloud. It’s that easy.</p>\\n<h4>By the end of this blog post you will know how to:</h4>\\n<ol>\\n<li>Setup project files and code</li>\\n<li>Setup the Serverless configuration file</li>\\n<li>Test the code in the local environment</li>\\n<li>Deploy to the cloud</li>\\n</ol>\\n<h4>Pre-requistes before getting started</h4>\\n<ul>\\n<li>You must have Node.js installed. To do this you need to go to <a href=\\\"nodejs.org\\\">Nodejs.org</a> and download it. Be sure to download LTS</li>\\n<li>Know how to read JavaScript (although you can write functions in Python, C# and JVM compatible languages)</li>\\n<li>An mild familiarity with AWS will be helpful to understanding what's going on.</li>\\n<li>Have serverless installed. Once you have npm installed just type <code class=\\\"language-text\\\">npm install -g serverless</code> in any directory in your terminal</li>\\n<li>\\n<p>I will use AWS for this tutorial since it is my preferred cloud provider, so that means you’ll need to install and authenticate the aws-cli. This can be done by reading through following three articles.</p>\\n<ol>\\n<li><a href=\\\"http://docs.aws.amazon.com/cli/latest/userguide/installing.html\\\">aws-cli installed</a></li>\\n<li><a href=\\\"http://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console\\\">AWS user created with programmatic access</a></li>\\n<li><a href=\\\"http://docs.aws.amazon.com/cli/latest/userguide/cli-config-files.html\\\">aws-cli authenticated</a></li>\\n</ol>\\n</li>\\n</ul>\\n<h3>Setting up the Project Files and Code</h3>\\n<p><a href=\\\"https://github.com/danielbh/getting-started-with-serverless-tutorial\\\">You can obtain the completed project here</a>. You will still need to add your Lambda endpoint to <code class=\\\"language-text\\\">index.html</code> to make it work.</p>\\n<p>Create the project in a desired location and then add the following files:</p>\\n<p>Add a file called <code class=\\\"language-text\\\">handler.js</code>. This will be the file that contains your lambda function. This lambda function will return your IP address.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">module<span class=\\\"token punctuation\\\">.</span>exports<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">getIP</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">,</span> context<span class=\\\"token punctuation\\\">,</span> callback<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> response <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    statusCode<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// 1</span>\\n    headers<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token string\\\">'Access-Control-Allow-Origin'</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'*'</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token comment\\\">// 2</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    body<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">.</span>requestContext<span class=\\\"token punctuation\\\">.</span>identity<span class=\\\"token punctuation\\\">.</span>sourceIp<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">//3</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">callback</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span> response<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<ol>\\n<li>A <code class=\\\"language-text\\\">200</code> status code is returned which signals that the function was run successfully.</li>\\n<li>This is required to allow Cross Origin Resource Sharing (CORS). Under default conditions a web page is not allowed to make http requests from an API that does not share the same domain name. CORS exists to prevent a security vulnerability called Cross-Site Request Forgery (CSRF). You can <a href=\\\"https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)\\\">read more about this vulnerability at OWASP</a>. For the purposes of this demo, it's not a big deal.</li>\\n<li>This will respond to the request with your IP address.</li>\\n</ol>\\n<p>Now, create a directory called <code class=\\\"language-text\\\">dist</code> and add a filed called <code class=\\\"language-text\\\">index.html</code>. This will be the static asset that you deploy as the front-end website for your lambda function. It will display your external IP address.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token doctype\\\">&lt;!DOCTYPE html></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>html</span> <span class=\\\"token attr-name\\\">lang</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>en<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">charset</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>UTF-8<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>title</span><span class=\\\"token punctuation\\\">></span></span>Hello Serverless<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>title</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script language-javascript\\\">\\n            <span class=\\\"token comment\\\">// 1</span>\\n            <span class=\\\"token keyword\\\">const</span> xhttp <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">XMLHttpRequest</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n            xhttp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">onreadystatechange</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>readyState <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">4</span> <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>status <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n                document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"app\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>responseText <span class=\\\"token comment\\\">// 2</span>\\n              <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n            <span class=\\\"token comment\\\">// 3</span>\\n            xhttp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">open</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"GET\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"http://localhost:3000\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n            xhttp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">send</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        </span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h1</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>app<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>html</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<ol>\\n<li>This is how old people make http requests with javascript in the browser.</li>\\n<li>The callback for receiving the external IP address. If the external IP address is successfully received it will print it to the webpage.</li>\\n<li>This is the code that executes the request to your lambda function.</li>\\n</ol>\\n<p>Now add <code class=\\\"language-text\\\">404.html</code>. This will be used when a user requests a page that does not exist.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token doctype\\\">&lt;!DOCTYPE html></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>html</span> <span class=\\\"token attr-name\\\">lang</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>en<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">charset</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>UTF-8<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>title</span><span class=\\\"token punctuation\\\">></span></span>404 Error<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>title</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h1</span><span class=\\\"token punctuation\\\">></span></span>404 Error: This page does not exist<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>html</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<h3>Setup the Serverless Configuration File</h3>\\n<p>Add <code class=\\\"language-text\\\">serverless.yml</code> to the root directory. This is the configuration file that will configure your cloud infrastructure. If you have never used yaml then you should keep in mind that white spaces do matter. It's basically JSON without brackets, commas, or apostrophes.</p>\\n<p>A <code class=\\\"language-text\\\">serverless.yml</code> template is divided into blocks. Each block as a purpose (see below).</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-yaml\\\"><code class=\\\"language-yaml\\\"><span class=\\\"token comment\\\"># 1</span>\\n<span class=\\\"token key atrule\\\">service</span><span class=\\\"token punctuation\\\">:</span> hello<span class=\\\"token punctuation\\\">-</span>serverless\\n\\n<span class=\\\"token comment\\\"># 2</span>\\n<span class=\\\"token key atrule\\\">provider</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> aws\\n  <span class=\\\"token key atrule\\\">runtime</span><span class=\\\"token punctuation\\\">:</span> nodejs6.10\\n  <span class=\\\"token key atrule\\\">region</span><span class=\\\"token punctuation\\\">:</span> us<span class=\\\"token punctuation\\\">-</span>east<span class=\\\"token punctuation\\\">-</span><span class=\\\"token number\\\">1</span>\\n\\n<span class=\\\"token comment\\\"># 3</span>\\n<span class=\\\"token key atrule\\\">functions</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token comment\\\">#4</span>\\n  <span class=\\\"token key atrule\\\">getIP</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">handler</span><span class=\\\"token punctuation\\\">:</span> handler.getIP\\n    <span class=\\\"token comment\\\"># 5</span>\\n    <span class=\\\"token key atrule\\\">events</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">http</span><span class=\\\"token punctuation\\\">:</span>\\n          <span class=\\\"token key atrule\\\">path</span><span class=\\\"token punctuation\\\">:</span> /\\n          <span class=\\\"token key atrule\\\">method</span><span class=\\\"token punctuation\\\">:</span> get\\n          <span class=\\\"token key atrule\\\">cors</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">true</span>\\n<span class=\\\"token comment\\\"># 6</span>\\n<span class=\\\"token key atrule\\\">resources</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">Outputs</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token comment\\\"># 7</span>\\n    <span class=\\\"token key atrule\\\">WebSiteUrl</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">Value</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token key atrule\\\">\\\"Fn::GetAtt\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>WebSite<span class=\\\"token punctuation\\\">,</span> WebsiteURL<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token key atrule\\\">WebSiteBucket</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">Value</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token key atrule\\\">Ref</span><span class=\\\"token punctuation\\\">:</span> WebSite<span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token key atrule\\\">Resources</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">WebSite</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">Type</span><span class=\\\"token punctuation\\\">:</span> \\\"AWS<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span>S3<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span>Bucket\\\" <span class=\\\"token comment\\\"># 8</span>\\n      <span class=\\\"token key atrule\\\">Properties</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token key atrule\\\">WebsiteConfiguration</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token comment\\\"># 9</span>\\n          <span class=\\\"token key atrule\\\">IndexDocument</span><span class=\\\"token punctuation\\\">:</span> index.html <span class=\\\"token comment\\\"># 10</span>\\n          <span class=\\\"token key atrule\\\">ErrorDocument</span><span class=\\\"token punctuation\\\">:</span> 404.html <span class=\\\"token comment\\\"># 11</span></code></pre>\\n      </div>\\n<ol>\\n<li>The <code class=\\\"language-text\\\">service</code> block is the name of the service</li>\\n<li>The <code class=\\\"language-text\\\">provider</code> block defines where your service will be deployed</li>\\n<li>The <code class=\\\"language-text\\\">functions</code> block defines what code to deploy. This is where you describe the lambda function you are deploying. This function is called \\\"getIP\\\". It has a handler that uses <code class=\\\"language-text\\\">handler.getIP</code> which maps back to the handler.js file.</li>\\n<li>The <code class=\\\"language-text\\\">events</code> block defines how to trigger the handler code. It states the path, to call the function, the REST method to use, and whether or not CORS is allowed.</li>\\n<li>The <code class=\\\"language-text\\\">resources</code> block defines additional resources to be provisioned. This can include a CloudFront distribution, SSL certifications, DNS mappings etc...</li>\\n<li>When you deploy this project it will create a <a href=\\\"https://aws.amazon.com/cloudformation/\\\">Cloud Formation</a> stack in AWS. The outputs are variables that are created when the Cloud Formation stack has finished initializing. You can access these outputs via an API. In this case we are saving these output urls for later, to deploy the static files with a shell script.</li>\\n<li>This will create an S3 bucket in AWS.</li>\\n<li>This will set the s3 bucket to be a static website mode.</li>\\n<li>This tells AWS where to find the index web page for the site.</li>\\n<li>This tells AWS where to put the \\\"not found\\\" web page for the site.</li>\\n</ol>\\n<h3>Test the code in the local environment</h3>\\n<p>Before deploying, it's nice to see if the code will work in the local environment. The API can be tested by downloading a Serverless plugin and running it. Serverless plugins are used to help the development process of Serverless API's. <a href=\\\"https://github.com/serverless/plugins\\\">Here is a comprehensive list of Serverless plugins</a>.</p>\\n<p>For this project we will use <code class=\\\"language-text\\\">serverless-offline</code> to enable offline support. To download it you need to type <code class=\\\"language-text\\\">npm i serverless-offline --save-dev</code>. This will add the dependency, and note it in the <code class=\\\"language-text\\\">package.json</code> in your root directory. This will help future developers install this project in their local environment.</p>\\n<p>Now you must add the plugin to <code class=\\\"language-text\\\">serverless.yml</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"> ...\\n\\n plugins:\\n    - serverless-offline</code></pre>\\n      </div>\\n<p>Now in the root directory type <code class=\\\"language-text\\\">serverless offline</code> you can also type <code class=\\\"language-text\\\">sls offline</code>.\\nNow open <code class=\\\"language-text\\\">index.html</code>. You should see \\\"127.0.0.1\\\" in the browser. This is your local IP. You will change the API endpoint address in <code class=\\\"language-text\\\">index.html</code> later, to point it to the live function.</p>\\n<h3>Deploy the Project</h3>\\n<p>Now it's time to deploy the tutorial!</p>\\n<p> All you need to do is the following in your terminal in the root directory: <code class=\\\"language-text\\\">sls deploy</code>.</p>\\n<p>It will take a few minutes maximum, but when its done it will output the endpoint URL. After its done the terminal output will look close to this...</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">danielhollcraft:~/projectDir $ sls deploy\\nServerless: Packaging service<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Creating Stack<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Checking Stack create progress<span class=\\\"token punctuation\\\">..</span>.\\n<span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span>.\\nServerless: Stack create finished<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Uploading CloudFormation <span class=\\\"token function\\\">file</span> to S3<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Uploading artifacts<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Uploading <span class=\\\"token function\\\">service</span> .zip <span class=\\\"token function\\\">file</span> to S3 <span class=\\\"token punctuation\\\">(</span>4.07 MB<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">..</span>.\\nServerless: Updating Stack<span class=\\\"token punctuation\\\">..</span>.\\nServerless: Checking Stack update progress<span class=\\\"token punctuation\\\">..</span>.\\n<span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span>.\\nServerless: Stack update finished<span class=\\\"token punctuation\\\">..</span>.\\nService Information\\nservice: hello-serverless\\nstage: dev\\nregion: us-east-1\\napi keys:\\n  None\\nendpoints:\\n  GET - https://<span class=\\\"token operator\\\">&lt;</span>endpoint-id<span class=\\\"token operator\\\">></span>.execute-api.us-east-1.amazonaws.com/dev/\\n<span class=\\\"token punctuation\\\">..</span>.</code></pre>\\n      </div>\\n<p>What did it do? It deployed an endpoint on AWS by generating a lambda function and connects the function to the API gateway so you can access it via a REST API. It also created two s3 buckets. One that will hold the web ui code (we'll deploy that next), and one to hold the Cloud Formation template which contains instructions for creating the infrastructure that was just generated. Also included, is a zipped bundle of your endpoint functions that you just deployed.</p>\\n<p>It should be noted that you deployed to <code class=\\\"language-text\\\">dev</code> which means you deployed to a testing endpoint. Of course you could use it for production, but it's encouraged to create another endpoint for production. One for testing, one for production. This is standard development life cycle workflow. To deploy to production you would type <code class=\\\"language-text\\\">sls deploy --stage &lt;whatever-you-call-production&gt;</code></p>\\n<p>Now it's time to deploy the front end code. You'll need to copy and paste the new endpoint URL of your live lambda function into <code class=\\\"language-text\\\">index.html</code>. The endpoint id can be found in the above terminal output. Copy and paste your your own endpoint.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">endpoints:\\n  GET - https://&lt;endpoint-id&gt;.execute-api.us-east-1.amazonaws.com/dev/</code></pre>\\n      </div>\\n<p>Copy it into the below part of the <code class=\\\"language-text\\\">index.html</code> file...</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"> xhttp.open(&quot;GET&quot;, /*copy it here*/, true);</code></pre>\\n      </div>\\n<p>As of July 2017, the shortest and most elegant way to deploy static files to a Serverless project for web rendering, is with bash scripts. I won't explain these too much, but essentially the below scripts will take the Cloud Formation Outputs that we placed in the <code class=\\\"language-text\\\">serverless.yml</code>, and it will use this to access the website bucket. By default these scripts will manipulate the dev bucket. You will need to add the stage name if you wish to target a different bucket. This can be done by appending the stage name at the end of the command <code class=\\\"language-text\\\">. script.sh &lt;name of stage&gt;</code>.</p>\\n<p>I recommend you create a directory called <code class=\\\"language-text\\\">scripts</code> and add the two scripts in.</p>\\n<p><code class=\\\"language-text\\\">deploy-static-files.sh</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token comment\\\">#!/usr/bin/env bash</span>\\n\\n<span class=\\\"token keyword\\\">set</span> -eu\\n\\nSTAGE<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">${1:-dev}</span>\\\"</span>\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Deploying static assets to <span class=\\\"token variable\\\">${STAGE}</span>...\\\"</span>\\n\\nBUCKET_NAME<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span>aws \\\\\\n    cloudformation describe-stacks \\\\\\n    --stack-name <span class=\\\"token string\\\">\\\"hello-serverless-<span class=\\\"token variable\\\">${STAGE}</span>\\\"</span> \\\\\\n    --query <span class=\\\"token string\\\">\\\"Stacks[0].Outputs[?OutputKey=='WebSiteBucket'] | [0].OutputValue\\\"</span> \\\\\\n    --output text<span class=\\\"token variable\\\">)</span></span>\\n\\nWEBSITE_URL<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span>aws \\\\\\n    cloudformation describe-stacks \\\\\\n    --stack-name <span class=\\\"token string\\\">\\\"hello-serverless-<span class=\\\"token variable\\\">${STAGE}</span>\\\"</span> \\\\\\n    --query <span class=\\\"token string\\\">\\\"Stacks[0].Outputs[?OutputKey=='WebSiteUrl'] | [0].OutputValue\\\"</span> \\\\\\n    --output text<span class=\\\"token variable\\\">)</span></span>\\n\\n<span class=\\\"token comment\\\">#Deploy site content</span>\\naws s3 <span class=\\\"token function\\\">sync</span> --acl <span class=\\\"token string\\\">'public-read'</span> --delete dist <span class=\\\"token string\\\">\\\"s3://<span class=\\\"token variable\\\">${BUCKET_NAME}</span>/\\\"</span>\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Bucket URL: <span class=\\\"token variable\\\">${WEBSITE_URL}</span>\\\"</span></code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">delete-static-files.sh</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token comment\\\">#!/usr/bin/env bash</span>\\n\\n<span class=\\\"token keyword\\\">set</span> -eu\\n\\nSTAGE<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">${1:-dev}</span>\\\"</span>\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"You are about to DELETE ALL STATIC ASSETS from <span class=\\\"token variable\\\">${STAGE}</span>\\\"</span>\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"If that's not what you want, press ctrl-C to kill this script\\\"</span>\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Or press enter to continue\\\"</span>\\n\\n<span class=\\\"token function\\\">read</span>\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Deleting static assets from <span class=\\\"token variable\\\">${STAGE}</span>...\\\"</span>\\n\\nBUCKET_NAME<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span>aws \\\\\\n    cloudformation describe-stacks \\\\\\n    --stack-name <span class=\\\"token string\\\">\\\"danielhollcraft-<span class=\\\"token variable\\\">${STAGE}</span>\\\"</span> \\\\\\n    --query <span class=\\\"token string\\\">\\\"Stacks[0].Outputs[?OutputKey=='WebSiteBucket'] | [0].OutputValue\\\"</span> \\\\\\n    --output text<span class=\\\"token variable\\\">)</span></span>\\n\\n<span class=\\\"token function\\\">mkdir</span> /tmp/empty\\n\\naws s3 <span class=\\\"token function\\\">sync</span> --delete /tmp/empty/ <span class=\\\"token string\\\">\\\"s3://<span class=\\\"token variable\\\">${BUCKET_NAME}</span>/\\\"</span>\\n\\n<span class=\\\"token function\\\">rmdir</span> /tmp/empty\\n\\n<span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string\\\">\\\"Bucket <span class=\\\"token variable\\\">${BUCKET_NAME}</span> has been emptied\\\"</span></code></pre>\\n      </div>\\n<p>You can add commands in the package.json to make calling these scripts easier</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token punctuation\\\">{</span>\\n\\n<span class=\\\"token operator\\\">...</span>\\n\\n <span class=\\\"token string\\\">\\\"scripts\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token string\\\">\\\"static:deploy\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"./scripts/deploy_static_files.sh\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token string\\\">\\\"static:destroy\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"./scripts/delete_static_files.sh\\\"</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Now to deploy your static files type the following in the root directory of your project: <code class=\\\"language-text\\\">npm run static:deploy</code>.</p>\\n<p>The terminal should output the following:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">Deploying static assets to dev<span class=\\\"token punctuation\\\">..</span>.\\nupload: dist/404.html to s3://hello-serverless-dev-website-uzv5zwnqswdi/404.html\\nupload: dist/index.html to s3://hello-serverless-dev-website-uzv5zwnqswdi/index.html\\nBucket URL: http://hello-serverless-dev-website-<span class=\\\"token operator\\\">&lt;</span>website-id<span class=\\\"token operator\\\">></span>.s3-website-us-east-1.amazonaws.com</code></pre>\\n      </div>\\n<p>Now navigate to the bucket URL. You now have an app that displays your external IP address to a web page!</p>\\n<h3>Next Steps...</h3>\\n<p>Serverless can also be used to setup the DNS routes to your static webste and implement SSL (for free). You can also setup a CloudFront distributions to cache your static assets for better site performance.</p>\\n<p>If you'd like to dive deeper with Serverless I recommend the following resources:</p>\\n<ul>\\n<li>\\n<p><a href=\\\"https://acloud.guru/bundle/start-serverless\\\">A Cloud Guru Serverless Bundle Course</a>: As far as I'm concerned these guys are the best at AWS cloud training out there. I've taken many of their courses, including this bundled course.</p>\\n</li>\\n<li>\\n<p><a href=\\\"https://serverless.com/framework/docs/\\\">Serverless Framework Documentation</a>: It's very detailed and useful.</p>\\n</li>\\n<li>\\n<p><a href=\\\"https://github.com/serverless/examples\\\">Serverless Framework Example Github Respository</a>: Where you can find many different starting templates for your next Serverless project.</p>\\n</li>\\n</ul>\\n<p>That's a wrap. If you have any more questions, or if you just want to nerd out over Serverless with a cup of coffee, feel free to <a href=\\\"/contact/\\\">contact me</a>.</p>\",\"frontmatter\":{\"title\":\"Deploy a Website and API with Serverless\",\"date\":\"07/19/2017\"}}},\"pathContext\":{\"slug\":\"/blog/deploy-a-website-api-with-serverless/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/blog-deploy-a-website-api-with-serverless.json\n// module id = 372\n// module chunks = 224177312327221"],"sourceRoot":""}